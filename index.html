<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HDD/CDD Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
    background-color: #fafafa;
  }
  h2 { color: #333; }
  canvas {
    width: 100%;
    max-width: 1200px;
    height: 500px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<h2>HDD/CDD Dashboard</h2>
<p>D√°ta naƒç√≠tan√© z Google Sheets CSV (publikuj ako <strong>CSV</strong>).</p>
<canvas id="hddCddChart"></canvas>

<script>
// ‚öôÔ∏è ZADAJ URL SVOJHO GOOGLE SHEET CSV
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxuCEA6n158C1ENeHT-tRC3fkzJhQHYEs35-EyzVfekXR31vEa7s0Aq4w9knwiE9N2kNt0p8uRB8U7/pub?gid=0&single=true&output=csv";

// üîπ Funkcia na naƒç√≠tanie CSV a konverziu na objekt
async function fetchData() {
  const res = await fetch(csvUrl);
  const text = await res.text();
  const rows = text.trim().split("\n").slice(1); // preskoƒç header
  const data = {};

  rows.forEach(row => {
    const [region, date, hdd, cdd] = row.split(",");
    if (!data[region]) data[region] = { days: [], hdd: [], cdd: [] };
    data[region].days.push(String(date));
    data[region].hdd.push(Number(hdd));
    data[region].cdd.push(Number(cdd));
  });

  return data;
}

// üîπ Funkcia na vykreslenie grafu
async function drawChart() {
  const data = await fetchData();
  const regions = Object.keys(data);

  // Labels = d√°tumy
  const labels = data[regions[0]].days;

  const datasets = [];

  regions.forEach((region) => {
    let hddColor, cddColor;

    // Farby pre jednotliv√© regi√≥ny
    switch(region) {
      case "Chicago":
        hddColor = 'rgba(255, 150, 150, 0.6)';
        cddColor = 'rgba(255, 0, 0, 0.6)';
        break;
      case "New York":
        hddColor = 'rgba(150, 200, 255, 0.6)';
        cddColor = 'rgba(0, 100, 255, 0.6)';
        break;
      case "Houston":
        hddColor = 'rgba(150, 255, 150, 0.6)';
        cddColor = 'rgba(0, 150, 0, 0.6)';
        break;
      case "Denver":
        hddColor = 'rgba(255, 200, 150, 0.6)';
        cddColor = 'rgba(255, 100, 0, 0.6)';
        break;
      case "Los Angeles":
        hddColor = 'rgba(200, 150, 255, 0.6)';
        cddColor = 'rgba(100, 0, 255, 0.6)';
        break;
      case "All Regions Sum":
        hddColor = 'rgba(0,0,0,0.8)';      // ƒçierna
        cddColor = 'rgba(120,120,120,0.8)'; // siv√°
        break;
      default:
        hddColor = 'rgba(150,150,150,0.6)';
        cddColor = 'rgba(100,100,100,0.6)';
    }

    // HDD
    datasets.push({
      label: region + " HDD",
      data: data[region].hdd,
      backgroundColor: hddColor,
      borderColor: hddColor,
      borderWidth: 1,
      type: 'bar'
    });

    // CDD
    datasets.push({
      label: region + " CDD",
      data: data[region].cdd,
      backgroundColor: cddColor,
      borderColor: cddColor,
      borderWidth: 1,
      type: 'bar'
    });
  });

  const ctx = document.getElementById("hddCddChart").getContext("2d");
  new Chart(ctx, {
    data: {
      labels: labels,
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        tooltip: {
          callbacks: {
            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toFixed(1)}`
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: "Degree Days (HDD/CDD)" }
        },
        x: {
          title: { display: true, text: "Date" }
        }
      }
    }
  });
}

// Spusti naƒç√≠tanie a kreslenie
drawChart();
</script>
</body>
</html>
