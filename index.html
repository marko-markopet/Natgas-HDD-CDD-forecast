// Funkcia na vykreslenie grafu
async function drawChart() {
    const data = await fetchData();
    const regions = Object.keys(data);

    // Použijeme poradové číslo dňa ako labely
    const labels = data[regions[0]].dates.map(d => "Day " + d);

    const datasets = [];
    const colors = [
        'rgba(255, 99, 132, 0.5)',
        'rgba(54, 162, 235, 0.5)',
        'rgba(255, 206, 86, 0.5)',
        'rgba(75, 192, 192, 0.5)',
        'rgba(153, 102, 255, 0.5)'
    ];

    regions.forEach((region, i) => {
        datasets.push({
            label: region + " HDD",
            data: data[region].hdd,
            backgroundColor: colors[i % colors.length],
            borderColor: colors[i % colors.length],
            type: 'bar',
            order: 1
        });
        datasets.push({
            label: region + " CDD",
            data: data[region].cdd.map(v => -v),
            backgroundColor: colors[(i + 1) % colors.length],
            borderColor: colors[(i + 1) % colors.length],
            type: 'bar',
            order: 1
        });
    });

    const ctx = document.getElementById('hddCddChart').getContext('2d');
    new Chart(ctx, {
        data: {
            labels: labels,
            datasets: datasets
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ": " + Math.abs(context.raw);
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) { return Math.abs(value); }
                    }
                }
            }
        }
    });
}
