<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HDD/CDD Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
    background-color: #fafafa;
  }
  h2 { color: #333; }
  canvas {
    width: 100%;
    max-width: 1000px;
    height: 500px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<h2>HDD/CDD Dashboard</h2>
<p>D√°ta naƒç√≠tan√© z Google Sheets CSV (publikuj ako <strong>CSV</strong>).</p>
<canvas id="hddCddChart"></canvas>

<script>
// ‚öôÔ∏è ZADAJ URL SVOJHO GOOGLE SHEET CSV
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxuCEA6n158C1ENeHT-tRC3fkzJhQHYEs35-EyzVfekXR31vEa7s0Aq4w9knwiE9N2kNt0p8uRB8U7/pub?gid=0&single=true&output=csv";

// üîπ Funkcia na naƒç√≠tanie CSV a konverziu na objekt
async function fetchData() {
  const res = await fetch(csvUrl);
  const text = await res.text();
  const rows = text.trim().split("\n").slice(1); // preskoƒç header
  const data = {};

  rows.forEach(row => {
    const [region, date, hdd, cdd] = row.split(",");
    if (!data[region]) data[region] = { days: [], hdd: [], cdd: [] };
    data[region].days.push(String(date));
    data[region].hdd.push(Number(hdd));
    data[region].cdd.push(Number(cdd));
  });

  return data;
}

// üîπ Funkcia na vykreslenie grafu
async function drawChart() {
  const data = await fetchData();
  const regions = Object.keys(data);

  // Generujeme labels ‚Äì poradov√© ƒç√≠sla dn√≠
  const labels = data[regions[0]].days.map(d => "" + d);

  const datasets = [];
  const colors = [
    'rgba(255, 99, 132, 0.6)',
    'rgba(54, 162, 235, 0.6)',
    'rgba(255, 206, 86, 0.6)',
    'rgba(75, 192, 192, 0.6)',
    'rgba(153, 102, 255, 0.6)'
  ];

  regions.forEach((region, i) => {
    // HDD (kladn√©)
    datasets.push({
      label: region + " HDD",
      data: data[region].hdd,
      backgroundColor: colors[i % colors.length],
      borderColor: colors[i % colors.length],
      borderWidth: 1,
      type: 'bar'
    });
    // CDD (z√°porn√©)
    datasets.push({
      label: region + " CDD",
      data: data[region].cdd.map(v => -v),
      backgroundColor: colors[(i + 1) % colors.length],
      borderColor: colors[(i + 1) % colors.length],
      borderWidth: 1,
      type: 'bar'
    });
  });

  const ctx = document.getElementById("hddCddChart").getContext("2d");
  new Chart(ctx, {
    data: {
      labels: labels,
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        tooltip: {
          callbacks: {
            label: (ctx) => `${ctx.dataset.label}: ${Math.abs(ctx.raw).toFixed(1)}`
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: value => Math.abs(value),
          },
          title: { display: true, text: "Degree Days (HDD/CDD)" }
        },
        x: {
          title: { display: true, text: "Day Index" }
        }
      }
    }
  });
}

// Spusti naƒç√≠tanie a kreslenie
drawChart();
</script>
</body>
</html>
